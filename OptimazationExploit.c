#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>

#define length 64

void hexDump(char *desc, void *addr, int len);
/**
 * this Functon is a validation funtion
 * test's if the input maches the password 
 * and cleans memory after
 * @param input is a 64 bytes array
 * @param pwd is a 64 bytes arry 
 * @return returns 0 if false and other if true
*/
int validatePassword(char input[length], char pwd[length]){
    int tmp;
    strcpy(pwd, "password1");
    printf("pwd: %p\n", pwd);
    tmp = strcmp(pwd, input) == 0;
        
    hexDump("pwd", pwd, 9);
    memset(pwd, 0, length); // cleanup
    return tmp;
}

void hexDump(char *desc, void *addr, int len);

int main(){
    char input[length];
    char pwd[length];

    printf("auth yourself:\n");
    gets(input);

    printf("intput: %p\n", input);
    int vaild = validatePassword(input, pwd);
    if (vaild)
     printf("vaild!\n");
    

    hexDump("input", input, 9);
    hexDump("pwd", input+0x40, 9);
    return 0;
}

/**
 * HexDump will write out the bits in between address
 * until it reachs length spesified
 * @param desc description on the read out
 * @param addr is the void pointer to the memories start point
 * @param len is a int and defines how long the fuction will read in memory
 * @todo write out proper text on the right side for easier readability
*/
void hexDump(char *desc, void *addr, int len){

    int i;
    unsigned char buff[17];
    unsigned char *pc = addr;

    if(desc != NULL)
        printf("%s:\n", desc);
    
    for(i = 0; i < len; i++){
        if ((i % 16) == 0){
            if(i != 0)
                printf("\t%s\n", buff);

            printf("\t%04x ", i);
        }
        printf(" %02x", pc[i]);

        if( (pc[i] < 0x20) || (pc[i] > 0x7e))
            buff[i % 16] = '.';
        else
            buff[(i % 16) + 1] = pc[i];
        buff[(i % 16) + 1] = '\0';
    }

    printf("\n");
}